<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMMANDER BODY JUDGE // V2.1 MATRIX</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <style>
        :root { --bg: #050505; --green: #00ff41; --gold: #ffd700; --red: #ff3333; --blue: #00bfff; }
        body { background: var(--bg); color: var(--green); font-family: 'Courier New', monospace; padding: 20px; max-width: 900px; margin: 0 auto; }
        .module { border: 1px solid #333; padding: 15px; margin-bottom: 20px; background: rgba(0,20,0,0.4); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        input, select { width: 100%; background: #0a0a0a; color: var(--green); border: 1px solid #333; padding: 12px; font-size: 1em; }
        button { width: 100%; padding: 15px; background: var(--green); color: #000; font-weight: bold; border: none; cursor: pointer; margin-top: 20px; font-size: 1.1em; }
        
        .med-card { background: #111; border-left: 4px solid #555; margin-bottom: 10px; padding: 10px; }
        .p1 { border-color: var(--gold); }
        .p2 { border-color: var(--blue); }
        .ext { border-color: #fff; }
        
        .badge { display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; margin-right: 5px; font-weight: bold; }
        .badge-p1 { background: var(--gold); color: #000; }
        .badge-p2 { background: var(--blue); color: #000; }
        .badge-ext { background: #fff; color: #000; }
    </style>
</head>
<body>

<h1>COMMANDER BODY JUDGE <span style="font-size:0.5em; color:#666">V2.1 MATRIX</span></h1>

<div class="module">
    <h3>MODULE 1 // åŸºç¡€ä½“å¾</h3>
    <div class="grid-2">
        <div><label>â¤ï¸ RHR (é™æ¯å¿ƒç‡)</label><input type="number" id="rhr" placeholder="e.g. 63"></div>
        <div><label>ğŸ’© å¤§ä¾¿/å± (Stool)</label>
            <select id="poop">
                <option value="normal">æ­£å¸¸</option>
                <option value="sticky">ğŸ’© ç²˜é©¬æ¡¶ (æ¹¿çƒ­)</option>
                <option value="loose">ğŸ’© ä¸æˆå½¢ (è„¾å¯’)</option>
                <option value="dry">ğŸ’© å¹²ç»“ (é˜´è™š)</option>
                <option value="fart_stink">ğŸ’¨ å±å¤š/è‡­é¸¡è›‹å‘³</option>
            </select>
        </div>
    </div>
    <div style="margin-top:15px">
        <label>ğŸ”¥ å¯’çƒ­ä½“æ„Ÿ (Battlefield Condition)</label>
        <select id="sensation">
            <option value="mix">ğŸŒ— æ­£å¸¸/æ— æ˜æ˜¾å¯’çƒ­</option>
            <option value="cold">â„ï¸ æ€•å†·/æ‰‹è„šå‡‰/å–œçƒ­é¥® (å¯’)</option>
            <option value="heat">ğŸ”¥ æ€•çƒ­/å£å¹²/å–œå†·é¥® (çƒ­)</option>
            <option value="damp">ğŸ’§ èº«ä½“é‡/å¤´è£¹/ç²˜è…» (æ¹¿)</option>
            <option value="pain">âš¡ åˆºç—›/æ‹’æŒ‰ (å®/æ·¤)</option>
        </select>
    </div>
</div>

<div class="module">
    <h3>MODULE 2 // æˆ˜åŒºé”å®š</h3>
    <div class="grid-2">
        <div><label>ğŸ“ æ ¸å¿ƒåŒºåŸŸ (Zone)</label>
            <select id="part" onchange="updateSpecifics()">
                <option value="head">ğŸ”´ å¤´éƒ¨/äº”å®˜ (Head)</option>
                <option value="neck_chest">ğŸŸ¡ é¢ˆè‚©/èƒ¸/è…¹ (Torso)</option>
                <option value="waist">ğŸŸ£ è…°éƒ¨/è‚¾åŒº (Waist)</option>
                <option value="limbs">ğŸ”µ å››è‚¢/å…³èŠ‚ (Limbs)</option>
                <option value="skin">âšª çš®è‚¤/ç—¤ç–® (Skin)</option>
                <option value="lower">ğŸŸ¢ ä¸‹ç„¦/å‰åˆ—è…º (Lower)</option>
            </select>
        </div>
        <div><label>ğŸ¯ ç²¾å‡†æ‰“å‡» (Target)</label>
            <select id="specific"><option value="none">-- è¯·é€‰æ‹© --</option></select>
        </div>
    </div>
    <button onclick="diagnose()">âš¡ EXECUTE PROTOCOL âš¡</button>
</div>

<div id="output" class="module" style="display:none">
    <h2 id="diag-title" style="color:#fff"></h2>
    <div id="med-list"></div>
    <div class="med-card" style="border-color: #fff; margin-top:20px;">
        <h3 style="margin:0 0 5px 0; color:#fff">ğŸŸ¢ SOP ACTION</h3>
        <p id="action-text" style="margin:0; color:#ccc"></p>
    </div>
</div>

<script>
// ==========================================
// 1. æ‰©å®¹å†›ç«åº“
// ==========================================
const DRUGS = {
    // TCM
    'chuanxiong': { name: "å·èŠèŒ¶è°ƒä¸¸", usage: "é¥­åæœç”¨ã€‚ç¥›é£æ­¢ç—›ã€‚", type: 'tcm' },
    'gegen': { name: "è‘›æ ¹æ±¤é¢—ç²’", usage: "æ¸©æ°´å†²æœã€‚è§£è‚Œé€šç»œã€‚", type: 'tcm' },
    'xiaochaihu': { name: "å°æŸ´èƒ¡é¢—ç²’", usage: "ä¸¤é¤ä¹‹é—´ã€‚ç–è‚å’Œèƒƒã€‚", type: 'tcm' },
    'lanqin': { name: "è“èŠ©å£æœæ¶²", usage: "é¥­åæœç”¨ã€‚æ¸…çƒ­è§£æ¯’ã€‚", type: 'tcm' },
    'qingwei': { name: "æ¸…èƒƒé»„è¿ä¸¸", usage: "é¥­åæœç”¨ã€‚æ¸…èƒƒç«ã€‚", type: 'tcm' },
    'muxiang': { name: "æœ¨é¦™é¡ºæ°”ä¸¸", usage: "é¥­åæœç”¨ã€‚è¡Œæ°”æ­¢ç—›ã€‚", type: 'tcm' },
    'baohe': { name: "ä¿å’Œä¸¸", usage: "é¥­åæœç”¨ã€‚æ¶ˆé£Ÿå¯¼æ»ã€‚", type: 'tcm' },
    'duhuo': { name: "ç‹¬æ´»å¯„ç”Ÿä¸¸", usage: "é¥­åæœç”¨ã€‚ç¥›é£é™¤æ¹¿ã€‚", type: 'tcm' },
    'ermiao': { name: "äºŒå¦™ä¸¸", usage: "é¥­åæœç”¨ã€‚æ¸…ä¸‹ç„¦æ¹¿çƒ­ã€‚", type: 'tcm' },
    'shenqi': { name: "é‡‘åŒ®è‚¾æ°”ä¸¸", usage: "æ·¡ç›æ°´ç©ºè…¹é€æœã€‚æ¸©è¡¥è‚¾é˜³ã€‚", type: 'tcm' },
    
    // West/Ext
    'ibuprofen': { name: "å¸ƒæ´›èŠ¬ (Ibuprofen)", usage: "é¥­åæœç”¨ã€‚æ­¢ç—›ã€‚", type: 'west' },
    'patch': { name: "æ°Ÿæ¯”æ´›èŠ¬å‡èƒ¶è´´è†", usage: "è´´æ‚£å¤„ã€‚", type: 'ext' },
    'adapalene': { name: "ç»´Aé…¸ä¹³è†", usage: "ç¡å‰æ¶‚ (é¿å…‰)ã€‚", type: 'ext' },
    'jinhuang': { name: "å¦‚æ„é‡‘é»„æ•£", usage: "èœ‚èœœè°ƒæ•·ã€‚", type: 'ext' },
    'erythromycin': { name: "çº¢éœ‰ç´ çœ¼è†", usage: "æ¶‚çœ¼ç‘ã€‚", type: 'ext' }
};

// ==========================================
// 2. å…¨æ¯åœ°å›¾ (Mapping)
// ==========================================
const SPECIFICS_MAP = {
    'head': [
        {val:'migraine', txt:'åå¤´ç—› (ä¸¤ä¾§/åè„‘)'},
        {val:'eye_pain', txt:'çœ¼ç›ç—›/éº¦ç²’è‚¿'},
        {val:'tooth_up', txt:'ä¸Šç‰™ç—› (èƒƒç«)'},
        {val:'tooth_down', txt:'ä¸‹ç‰™ç—› (å¤§è‚ ç«)'},
        {val:'nose_pain', txt:'é¼»è…”å†·ç—› (æ„Ÿå†’å…†)'}
    ],
    'neck_chest': [
        {val:'neck', txt:'é¢ˆæ¤åƒµç—›'},
        {val:'chest', txt:'å«èƒ¸èƒ¸ç—› (ç¥ç»æ€§)'},
        {val:'belly_left', txt:'å·¦ä¸‹è…¹ç—› (æ°”æ»/ä¾¿ç§˜)'},
        {val:'belly_right', txt:'å³ä¸‹è…¹éšç—› (æ¹¿çƒ­)'},
        {val:'belly_center', txt:'è„å‘¨éšç—› (è„¾å¯’)'}
    ],
    'waist': [
        {val:'waist_strain', txt:'åŠ³ç´¯è…°é…¸ (åˆºç—›/åƒµç¡¬)'},
        {val:'waist_kidney', txt:'è‚¾è™šè…°é…¸ (é…¸è½¯/å–œæŒ‰)'}
    ],
    'skin': [
        {val:'acne_mouth', txt:'å˜´å‘¨/ä¸‹å·´ç—¤ç–® (èƒƒç«)'},
        {val:'acne_nose', txt:'é¼»å‘¨/é¢å¤´ç—¤ç–® (è‚ºçƒ­)'},
        {val:'acne_butt', txt:'å±è‚¡ç––å­ (åæ¿ç–®)'}
    ],
    'limbs': [
        {val:'joint', txt:'å…³èŠ‚æ¸¸èµ°ç—›'},
        {val:'knee', txt:'è†ç›–/å¤§èƒ¯ç—› (ç‰©ç†ä¼¤)'}
    ],
    'lower': [
        {val:'prostate', txt:'å‰åˆ—è…º/å°¿çŸ­èµ¤'}
    ]
};

function updateSpecifics() {
    const part = document.getElementById('part').value;
    const s = document.getElementById('specific');
    s.innerHTML = '<option value="none">-- è¯·é€‰æ‹© --</option>';
    if(SPECIFICS_MAP[part]) SPECIFICS_MAP[part].forEach(o => s.innerHTML += `<option value="${o.val}">${o.txt}</option>`);
}

// ==========================================
// 3. æ ¸å¿ƒè£å†³
// ==========================================
function diagnose() {
    const part = document.getElementById('part').value;
    const spec = document.getElementById('specific').value;
    const sens = document.getElementById('sensation').value;
    const poop = document.getElementById('poop').value;

    let title = "", p1 = null, p2 = null, ext = null, action = "";

    // --- è·¯ç”±ç³»ç»Ÿ ---

    // A. çš®è‚¤åˆ†åŒº
    if (part === 'skin') {
        if (spec === 'acne_mouth') {
            title = "ã€èƒƒç«ä¸Šè’¸ã€‘"; p1 = 'qingwei'; ext = 'adapalene';
            action = "å¿Œç”œé£Ÿã€æ²¹ç‚¸ã€‚å¤šåƒç»¿è±†ã€‚";
        } else if (spec === 'acne_nose') {
            title = "ã€è‚ºç»é£çƒ­ã€‘"; p1 = 'lanqin'; ext = 'adapalene';
            action = "ä¸åƒè¾£æ¤’ï¼Œå¤šå–æ°´ã€‚";
        } else if (spec === 'acne_butt') {
            title = "ã€æ¹¿çƒ­æ·¤ç§¯ã€‘"; p1 = 'ermiao'; ext = 'jinhuang';
            action = "ä¿æŒå¹²ç‡¥ï¼Œæš‚åœéª‘è¡Œã€‚";
        }
    }

    // B. è…¹éƒ¨åˆ†åŒº
    else if (part === 'neck_chest') {
        if (spec === 'belly_left') {
            title = "ã€è‚ é“æ°”æ»ã€‘"; p1 = 'muxiang';
            action = "æ‰è…¹ï¼Œå¼€å¡éœ²è¾…åŠ©æ’ä¾¿ã€‚";
        } else if (spec === 'belly_right') {
            title = "ã€è‚ é“æ¹¿çƒ­ã€‘"; p1 = 'ermiao';
            action = "è‹¥å‰§ç—›ç«‹å³å°±åŒ»(é˜‘å°¾é£é™©)ã€‚æ¸…æ·¡é¥®é£Ÿã€‚";
        } else if (spec === 'belly_center') {
            if (sens === 'cold') {
                title = "ã€ä¸­ç„¦è™šå¯’ã€‘"; p1 = 'xiangsha'; // æ²¡ç»™é™„å­ï¼Œä¿å®ˆç»™é¦™ç ‚
                action = "çƒ­æ°´è¢‹çƒ­æ•·ã€‚";
            } else {
                title = "ã€é£Ÿç§¯è…¹ç—›ã€‘"; p1 = 'baohe';
                action = "å°‘åƒä¸€é¡¿ã€‚";
            }
        } else if (spec === 'neck') {
            title = "ã€é¢ˆæ¤ç—…ã€‘"; p1 = 'gegen'; ext = 'patch';
            action = "çƒ­æ•·åé¢ˆã€‚";
        }
    }

    // C. è…°ç—›é‰´åˆ«
    else if (part === 'waist') {
        if (spec === 'waist_strain') {
            title = "ã€è…°è‚ŒåŠ³æŸ/ç‰©ç†ä¼¤ã€‘"; p1 = 'duhuo'; ext = 'patch';
            action = "ç¡ç¡¬æ¿åºŠï¼Œç¦æ­¢å¼¯è…°æé‡ç‰©ã€‚";
        } else if (spec === 'waist_kidney') {
            if (sens === 'cold' || sens === 'mix') {
                title = "ã€è‚¾é˜³ä¸è¶³ã€‘"; p1 = 'shenqi';
                action = "è‰¾ç¸å‘½é—¨ï¼ŒèŠ‚åˆ¶æ€§ç”Ÿæ´»ã€‚";
            } else {
                title = "ã€è‚¾é˜´äºè™šã€‘"; // æ²¡ç»™å…­å‘³åœ°é»„ï¼Œç”¨é£Ÿç–—ä»£æ›¿
                action = "å¤šåƒé»‘è±†/é»‘èŠéº»ï¼Œé¿å…ç†¬å¤œã€‚";
            }
        }
    }

    // D. å¤´éƒ¨/äº”å®˜ (å¤ç”¨ä¹‹å‰é€»è¾‘)
    else if (part === 'head') {
        if (spec === 'migraine') {
            title = "ã€åå¤´ç—›ã€‘"; p1 = 'chuanxiong'; p2 = 'ibuprofen';
            if(sens==='mix') p1='xiaochaihu';
            action = "é¿å…‰ä¼‘æ¯ã€‚";
        } else if (spec === 'tooth_up') {
            title = "ã€èƒƒç«ç‰™ç—›ã€‘"; p1 = 'qingwei'; p2 = 'ibuprofen';
            action = "å¿Œé…’ã€‚";
        }
    }

    // E. é»˜è®¤/Fallback
    if (!title) {
        title = "ã€æ•°æ®ä¸è¶³ã€‘"; 
        action = "è¯·å®Œå–„å…·ä½“ç—‡çŠ¶ã€‚";
    }

    render(title, p1, p2, ext, action);
}

function render(title, p1Key, p2Key, extKey, actionText) {
    document.getElementById('output').style.display = 'block';
    document.getElementById('diag-title').innerText = title;
    document.getElementById('action-text').innerText = actionText;
    
    const list = document.getElementById('med-list');
    list.innerHTML = '';

    function createCard(key, role) {
        if(!key) return;
        const d = DRUGS[key];
        if(!d) return; 
        let badgeClass = role === 'p1' ? 'badge-p1' : (role === 'p2' ? 'badge-p2' : 'badge-ext');
        let roleName = role === 'p1' ? 'ğŸ‘‘ ä¸»å°†' : (role === 'p2' ? 'ğŸ›¡ï¸ å‰¯å°†' : 'ğŸ©¹ å¤–ç”¨');
        
        return `
            <div class="med-card ${role === 'ext' ? 'ext' : (role === 'p1' ? 'p1' : 'p2')}">
                <div style="display:flex; justify-content:space-between; align-items:center">
                    <span style="font-size:1.1em; font-weight:bold; color:#fff">${d.name}</span>
                    <span class="badge ${badgeClass}">${roleName}</span>
                </div>
                <div style="font-size:0.9em; color:#aaa; margin-top:5px; font-style:italic">SOP: ${d.usage}</div>
            </div>
        `;
    }

    if (p1Key) list.innerHTML += createCard(p1Key, 'p1');
    if (p2Key) list.innerHTML += createCard(p2Key, 'p2');
    if (extKey) list.innerHTML += createCard(extKey, 'ext');
}
</script>

</body>
</html>
