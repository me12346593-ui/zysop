<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMMANDER BODY JUDGE // V1.7 PRIVATE</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <style>
        :root { --bg: #050505; --green: #00ff41; --red: #ff3333; --yellow: #ffcc00; --cyan: #00ffff; --dim: #444; }
        body { background: var(--bg); color: var(--green); font-family: 'Courier New', monospace; padding: 20px; max-width: 900px; margin: 0 auto; }
        h1, h2 { border-bottom: 1px solid var(--green); text-transform: uppercase; letter-spacing: 2px; }
        .module { border: 1px solid #333; padding: 15px; margin-bottom: 20px; background: rgba(0,20,0,0.4); box-shadow: 0 0 10px rgba(0,255,0,0.05); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        input, select { 
            width: 100%; background: #0a0a0a; color: var(--green); 
            border: 1px solid #333; padding: 12px; box-sizing: border-box; 
            font-family: inherit; font-size: 1em;
        }
        input:focus, select:focus { outline: none; border-color: var(--green); box-shadow: 0 0 5px var(--green); }
        
        button { 
            width: 100%; padding: 15px; background: var(--green); color: #000; 
            font-weight: bold; border: none; cursor: pointer; font-size: 1.2em; 
            margin-top: 20px; text-transform: uppercase; transition: 0.2s;
        }
        button:hover { background: #fff; box-shadow: 0 0 15px var(--green); }
        
        /* è¯å…¸æ ·å¼ */
        .med-box { margin-bottom: 15px; padding: 15px; border-left: 5px solid; background: #0f0f0f; }
        .tcm { border-color: var(--yellow); }
        .west { border-color: #fff; color: #ddd; }
        .action { border-color: var(--cyan); color: var(--cyan); }
        .warning { border-color: var(--red); color: var(--red); font-weight: bold; animation: pulse 2s infinite; }
        
        .tag { display: inline-block; padding: 4px 10px; background: #1a1a1a; font-size: 0.9em; margin-right: 8px; margin-bottom: 8px; border-radius: 4px; border: 1px solid #333; }
        .tag-tcm { color: var(--yellow); border-color: #554400; }
        .tag-west { color: #fff; border-color: #444; }

        @keyframes pulse { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }
    </style>
</head>
<body>

<h1>COMMANDER BODY JUDGE <span style="font-size:0.5em; color:var(--dim)">V1.7 PRIVATE</span></h1>

<div class="module">
    <div style="display:flex; justify-content:space-between; color:var(--yellow); font-size:0.9em;">
        <span id="bazi-info">CALCULATING...</span>
        <span id="env-display">ENV CHECK</span>
    </div>
    <div style="margin-top:15px; border-top:1px dashed #333; padding-top:10px;">
        <label>ğŸŒ ç¯å¢ƒ/èŠ‚æ°”ä¿®æ­£ (Manual Override)</label>
        <select id="env">
            <option value="normal">âœ… å¹³ç¨³/æ— æ„Ÿ</option>
            <option value="damp">ğŸ’§ æ¹¿æ°”é‡/å›å—å¤© (åŠ é‡è„¾è™š/æ°´è‚¿)</option>
            <option value="cold">â„ï¸ å¯’å†·/é˜´é›¨ (åŠ é‡é˜³è™š/ç—›æ„Ÿ)</option>
            <option value="dry">ğŸ”¥ å¹²ç‡¥/æš–æ°”æˆ¿ (ä¼¤é˜´/ä¾¿ç§˜)</option>
        </select>
    </div>
</div>

<div class="module">
    <h3>INPUT DATA // ç—‡çŠ¶é”å®š</h3>
    
    <div class="grid-2">
        <div><label>â¤ï¸ RHR (é™æ¯å¿ƒç‡)</label><input type="number" id="rhr" placeholder="e.g. 63"></div>
        <div><label>ğŸ’© å¤§ä¾¿å½¢æ€ (æ ¸å¿ƒæŒ‡æ ‡)</label>
            <select id="poop">
                <option value="normal">é¦™è•‰ä¾¿ (Normal)</option>
                <option value="sticky">ç²˜é©¬æ¡¶/æ’ä¸å‡€ (æ¹¿çƒ­/Damp-Heat)</option>
                <option value="loose">ä¸æˆå½¢/ç¨€æº (è„¾å¯’/Cold)</option>
                <option value="dry">å¹²ç»“/ç¾Šå±è›‹ (é˜´è™š/Dry)</option>
                <option value="water">æ°´æ ·æ³» (æ€¥ç—‡/Acute)</option>
            </select>
        </div>
    </div>

    <div class="grid-2" style="margin-top:15px">
        <div><label>ğŸ“ æ ¸å¿ƒä¸é€‚åŒºåŸŸ</label>
            <select id="part" onchange="updateSpecifics()">
                <option value="stomach">ğŸŸ¡ è„¾èƒƒ/æ¶ˆåŒ– (Stomach)</option>
                <option value="lower">ğŸ”´ ä¸‹ç„¦/å‰åˆ—è…º/æ°´è‚¿ (Lower Jiao)</option>
                <option value="head">âšª å¤´éƒ¨/åå¤´ç—› (Head/Migraine)</option>
                <option value="respiratory">ğŸ’¨ å‘¼å¸/å’½å–‰ (Lung/Throat)</option>
                <option value="general">ğŸ’¤ å…¨èº«/ç¡çœ /æƒ…ç»ª (General)</option>
            </select>
        </div>
        <div><label>ğŸ” å¯’çƒ­/ä½“æ„Ÿ</label>
            <select id="sensation">
                <option value="mix">ğŸŒ— å¿½å†·å¿½çƒ­/å£è‹¦ (å°‘é˜³)</option>
                <option value="damp">ğŸ’§ èº«ä½“é‡/è™šèƒ–/ç²˜è…» (æ¹¿)</option>
                <option value="heat">ğŸ”¥ æ€•çƒ­/å£å¹²/çƒ¦èº (çƒ­)</option>
                <option value="cold">â„ï¸ æ€•å†·/æ‰‹è„šå‡‰ (å¯’)</option>
                <option value="pain">âš¡ åˆºç—›/å‰§ç—› (æ·¤/å®)</option>
            </select>
        </div>
    </div>

    <div id="specific-container" style="margin-top:15px;">
        <label>ğŸ¯ ç²¾å‡†ç—‡çŠ¶ (Specific Symptom)</label>
        <select id="specific">
            <option value="none">-- è¯·é€‰æ‹© --</option>
            </select>
    </div>

    <button onclick="diagnose()">âš¡ EXECUTE PROTOCOL âš¡</button>
</div>

<div id="output" class="module" style="display:none">
    <h2 id="diag-title" style="color:#fff"></h2>
    <div id="result-container"></div>
</div>

<script>
// ==========================================
// 1. å†›ç«åº“ (The Private Arsenal)
// ==========================================
const ARSENAL = {
    // === å¤´éƒ¨ (Head) ===
    'migraine_wind_heat': {
        title: "ã€é£ç«ä¸Šæ‰°/åå¤´ç—›ã€‘",
        tcm: ["é˜²é£é€šåœ£ä¸¸ (æ™¨é—´ä¸“ç”¨/Morning Only)", "å·èŠèŒ¶è°ƒæ•£"],
        west: ["å¸ƒæ´›èŠ¬ (Ibuprofen)", "è‹ç³–é…¸é• (Magtein)"],
        action: "æ—©æ™¨æœç”¨ï¼Œæ™šä¸Šç¦ç”¨(é˜²å¤±çœ )ã€‚è‹¥RHR>70æˆ–è…¹æ³»ä¸¥é‡ï¼Œç«‹å³åœè¯ã€‚",
        warn: "âš ï¸ è­¦å‘Šï¼šå«éº»é»„/å¤§é»„ã€‚å¿ƒç‡é«˜æˆ–æ‹‰è‚šå­æ—¶ç¦æ­¢ä½¿ç”¨ã€‚"
    },

    // === è„¾èƒƒ (Stomach) ===
    'stomach_rebellious': {
        title: "ã€èƒƒæ°”ä¸Šé€†/SOPå¤±æ§ã€‘",
        tcm: ["æ—‹è¦†èŠ±ä»£èµ­çŸ³æ±¤ (é™é€†åŒ–ç—°)", "é¦™ç ‚å…»èƒƒä¸¸"],
        west: ["å¤šæ½˜ç«‹é…® (Domperidone)", "å¥¥ç¾æ‹‰å”‘"],
        action: "æ‹æ‰“èƒƒç»ï¼Œåå’½å£æ°´ï¼Œåªåƒæµé£Ÿã€‚SOPï¼šæ”¾æ¾è…¹éƒ¨ã€‚"
    },
    'stomach_liver': { 
        title: "ã€è‚éƒæ°”æ»/æƒ…ç»ªèƒƒç—›ã€‘",
        tcm: ["æŸ´èƒ¡ç–è‚æ•£", "é€é¥ä¸¸ (ç–è‚å…»è¡€)", "å·¦é‡‘ä¸¸"],
        west: ["é“ç¢³é…¸é•"],
        action: "æ‰å¤ªå†²ç©´ï¼Œæ·±å‘¼å¸ï¼Œå‡å°‘ä¿¡æ¯è¾“å…¥ã€‚"
    },
    'stomach_damp_cold': {
        title: "ã€å¯’æ¹¿å›°è„¾ã€‘",
        tcm: ["é¦™ç ‚å…»èƒƒä¸¸", "é™„å­ç†ä¸­ä¸¸ (çº¯é˜³è™š)", "è—¿é¦™æ­£æ°”ä¸¸"],
        west: ["å¤šé…¶ç‰‡"],
        action: "å§œæ£èŒ¶ï¼Œè‰¾ç¸ç¥é˜™ï¼Œå¿Œç”Ÿå†·ã€‚"
    },

    // === ä¸‹ç„¦ (Lower Jiao) ===
    'lower_damp_heat': {
        title: "ã€ä¸‹ç„¦æ¹¿çƒ­/å‰åˆ—è…ºã€‘",
        tcm: ["äºŒå¦™ä¸¸ (ç‡¥æ¹¿æ¸…çƒ­/æ ¸å¿ƒ)", "é¾™èƒ†æ³»è‚ä¸¸ (è‚ç«æ—ºç”¨)"],
        west: ["å·¦æ°§æ°Ÿæ²™æ˜Ÿ (L3/éµåŒ»å˜±)", "å¸ƒæ´›èŠ¬"],
        action: "æ¸©æ°´åæµ´(å¿…åš)ï¼Œå¤šå–æ°´ï¼Œè†èƒ¸ä½ã€‚å¿Œé…’è¾£ã€‚",
        warn: "âš ï¸ è‹¥å¤§ä¾¿å¹²ç»“(ç¾Šå±è›‹)ï¼Œç«‹å³åœç”¨äºŒå¦™ä¸¸ï¼Œé˜²ä¾¿ç§˜ã€‚"
    },
    'water_retention': { // æ›¿ä»£çœŸæ­¦æ±¤çš„å®‰å…¨ç‰ˆ
        title: "ã€é˜³è™šæ°´æ³›/æ°´è‚¿ã€‘",
        tcm: ["é‡‘åŒ®è‚¾æ°”ä¸¸ (æ¸©è¡¥è‚¾é˜³)", "äº”è‹“æ•£ (åˆ©æ°´æ¸—æ¹¿)"],
        west: ["æ°¢æ°¯å™»å—ª (æ…ç”¨)"],
        action: "è‰¾ç¸å‘½é—¨ï¼Œçº¢è±†è–ç±³æ°´(ç‚’ç†Ÿè–ç±³)ã€‚"
    },
    'qi_def_water': { // è™šèƒ–è‡ªæ±—
        title: "ã€è¡¨è™šä¸å›º/é£æ°´ã€‘",
        tcm: ["é˜²å·±é»„èŠªæ±¤ (ç›Šæ°”åˆ©æ°´)", "é»„èŠªç‰‡"],
        west: ["æš‚æ— "],
        action: "é¿é£ï¼Œé»„èŠªç…®æ°´ã€‚"
    },

    // === å‘¼å¸ (Lung) ===
    'lung_dry': {
        title: "ã€è‚ºé˜´äºè™š/ç‡¥å’³ã€‘",
        tcm: ["æ²™å‚éº¦å†¬æ±¤ (å…»é˜´æ¶¦è‚º)", "å·è´æ‡æ·ç³–æµ†"],
        west: ["ä¹™é…°åŠèƒ±æ°¨é…¸"],
        action: "æ¢¨æ±¤ï¼ŒåŠ æ¹¿å™¨ã€‚å¿Œç‡¥çƒ­é£Ÿç‰©ã€‚"
    },
    'lung_def': {
        title: "ã€è‚ºæ°”è™šå¯’ã€‘",
        tcm: ["è¡¥ä¸­ç›Šæ°”ä¸¸ (åŸ¹åœŸç”Ÿé‡‘)", "ç‰å±é£æ•£"],
        west: ["ç»´ç”Ÿç´ C"],
        action: "é»„èŠªç‰‡ç…®æ°´ï¼ŒèƒŒéƒ¨ä¿æš–ã€‚"
    },

    // === å…¨èº«/ç¡çœ  (General) ===
    'insomnia_def': {
        title: "ã€è‚è¡€ä¸è¶³/è™šçƒ¦å¤±çœ ã€‘",
        tcm: ["é…¸æ£ä»æ±¤ (å…»è¡€å®‰ç¥/æ ¸å¿ƒæ–¹)", "é€é¥ä¸¸"],
        west: ["è¤ªé»‘ç´ ", "è‹ç³–é…¸é•"],
        action: "ä¾§å§ï¼Œç¡å‰ç¦æ‰‹æœºï¼Œå†¥æƒ³ã€‚"
    },
    'fatigue_qi_yin': {
        title: "ã€æ°”é˜´ä¸¤è™š/ç–²åŠ³ã€‘",
        tcm: ["è¥¿æ´‹å‚ (è¡¥æ°”å…»é˜´)", "ç”Ÿè„‰é¥®"],
        west: ["è¾…é…¶Q10"],
        action: "è¥¿æ´‹å‚å«ç‰‡ï¼Œç»å¯¹ä¼‘æ¯ã€‚ä¸å»ºè®®å‰§çƒˆè¿åŠ¨ã€‚"
    },
    'shaoyang_mix': {
        title: "ã€å°‘é˜³è¯/å¿½å†·å¿½çƒ­ã€‘",
        tcm: ["å°æŸ´èƒ¡é¢—ç²’ (å’Œè§£å°‘é˜³)", "æŸ´èƒ¡æ¡‚æå¹²å§œæ±¤ (èƒ†çƒ­è„¾å¯’/å£è‹¦è…¹æ³»)"],
        west: ["å¸ƒæ´›èŠ¬ (å‘çƒ­æ—¶)"],
        action: "æ¸…æ·¡é¥®é£Ÿï¼Œæ—©ç¡å…»å°‘é˜³ã€‚"
    }
};

// ==========================================
// 2. äº¤äº’é€»è¾‘ (Specifics Logic)
// ==========================================
const SPECIFICS_MAP = {
    'stomach': [
        {val: 'hiccup', txt: 'æ‰“å—/åé…¸ (æ—‹è¦†èŠ±)'},
        {val: 'stress', txt: 'ç”Ÿæ°”åç—›/ä¸¤èƒèƒ€ (æŸ´èƒ¡/é€é¥)'},
        {val: 'bloat', txt: 'èƒ€æ°”/éšç—›/å–œæŒ‰ (é¦™ç ‚)'}
    ],
    'lower': [
        {val: 'prostate', txt: 'å°¿é¢‘/å°¿ç—›/å±è‚¡çƒ­ (äºŒå¦™ä¸¸)'},
        {val: 'swelling', txt: 'ä¸‹è‚¢æ°´è‚¿/æŒ‰ä¹‹å‡¹é™· (è‚¾æ°”/äº”è‹“)'}
    ],
    'head': [
        {val: 'migraine', txt: 'åå¤´ç—›/è¡€ç®¡è·³ç—› (é˜²é£é€šåœ£)'},
        {val: 'dull', txt: 'æ˜æ²‰/å¦‚è£¹ (æ¹¿é‡)'}
    ],
    'respiratory': [
        {val: 'dry', txt: 'å¹²å’³/å°‘ç—°/å£å¹² (æ²™å‚)'},
        {val: 'phlegm', txt: 'ç—°å¤š/æ¸…ç¨€ (è¡¥ä¸­)'}
    ],
    'general': [
        {val: 'insomnia', txt: 'å¤±çœ /å¿ƒæ‚¸/å¤šæ¢¦ (é…¸æ£ä»)'},
        {val: 'sweat', txt: 'è‡ªæ±—/è™šèƒ–/æ€•é£ (é˜²å·±é»„èŠª)'},
        {val: 'tired', txt: 'æåº¦ç–²åŠ³/æ°”çŸ­ (è¥¿æ´‹å‚)'}
    ]
};

function updateSpecifics() {
    const part = document.getElementById('part').value;
    const specSelect = document.getElementById('specific');
    specSelect.innerHTML = '<option value="none">-- è¾…åŠ©åˆ¤æ–­ (å¯é€‰) --</option>';
    if (SPECIFICS_MAP[part]) {
        SPECIFICS_MAP[part].forEach(opt => {
            specSelect.innerHTML += `<option value="${opt.val}">${opt.txt}</option>`;
        });
    }
}

window.onload = () => {
    updateSpecifics();
    const today = Lunar.fromDate(new Date());
    document.getElementById('bazi-info').innerText = `ğŸ“… ${today.getDayInGanZhi()}æ—¥`;
};

// ==========================================
// 3. è£å†³é€»è¾‘ (The Commander's Logic)
// ==========================================
function diagnose() {
    const part = document.getElementById('part').value;
    const spec = document.getElementById('specific').value;
    const poop = document.getElementById('poop').value;
    const sens = document.getElementById('sensation').value;
    const rhr = parseInt(document.getElementById('rhr').value) || 0;
    
    let key = "";

    // --- è·¯ç”±åˆ¤å®š ---
    
    // A. å¤´éƒ¨ (Head)
    if (part === 'head') {
        // é˜²é£é€šåœ£ä¸¸åˆ¤å®šï¼šå¿…é¡»æ˜¯åå¤´ç—› + æœ‰çƒ­è±¡
        if (spec === 'migraine' && (sens === 'heat' || sens === 'pain')) {
            key = 'migraine_wind_heat';
        } else {
            key = 'migraine_wind_heat'; // é»˜è®¤èµ°åå¤´ç—›é€»è¾‘ï¼Œä½†ä¾é Warningæ§åˆ¶
        }
    }

    // B. è„¾èƒƒ (Stomach)
    else if (part === 'stomach') {
        if (spec === 'hiccup') key = 'stomach_rebellious'; // æ—‹è¦†èŠ±
        else if (spec === 'stress') key = 'stomach_liver'; // æŸ´èƒ¡/é€é¥
        else if (sens === 'cold' || poop === 'loose') key = 'stomach_damp_cold'; // é¦™ç ‚
        else if (sens === 'mix') key = 'shaoyang_mix'; // å°æŸ´èƒ¡
        else key = 'stomach_damp_cold'; // é»˜è®¤
    }

    // C. ä¸‹ç„¦ (Lower)
    else if (part === 'lower') {
        if (spec === 'prostate' || poop === 'sticky' || sens === 'damp') {
            key = 'lower_damp_heat'; // äºŒå¦™ä¸¸
        } else if (spec === 'swelling') {
            if (sens === 'cold' || rhr < 60) key = 'water_retention'; // é‡‘åŒ®/äº”è‹“
            else key = 'qi_def_water'; // é˜²å·±é»„èŠª
        } else {
            key = 'water_retention';
        }
    }

    // D. å‘¼å¸ (Respiratory)
    else if (part === 'respiratory') {
        if (spec === 'dry' || sens === 'heat') key = 'lung_dry'; // æ²™å‚éº¦å†¬
        else key = 'lung_def'; // è¡¥ä¸­/ç‰å±é£
    }

    // E. å…¨èº« (General)
    else if (part === 'general') {
        if (spec === 'insomnia') key = 'insomnia_def'; // é…¸æ£ä»
        else if (spec === 'sweat') key = 'qi_def_water'; // é˜²å·±é»„èŠª
        else if (spec === 'tired') key = 'fatigue_qi_yin'; // è¥¿æ´‹å‚
        else key = 'shaoyang_mix'; // å°æŸ´èƒ¡
    }

    // F. å°‘é˜³ä¿®æ­£ (å…¨å±€)
    if (sens === 'mix' && key === "") key = 'shaoyang_mix';
    if (key === "") key = 'stomach_damp_cold'; // Fallback

    renderResult(key, poop, rhr);
}

function renderResult(key, poop, rhr) {
    const db = ARSENAL[key];
    const output = document.getElementById('output');
    const container = document.getElementById('result-container');
    output.style.display = 'block';
    document.getElementById('diag-title').innerText = db.title;
    container.innerHTML = '';

    // 1. åŠ¨æ€ç”Ÿæˆè­¦å‘Š (Dynamic Warnings)
    let warningMsg = "";
    
    // äºŒå¦™ä¸¸ç†”æ–­æœºåˆ¶
    if (key === 'lower_damp_heat' && (poop === 'dry' || poop === 'normal')) {
        warningMsg += "ğŸ›‘ ç†”æ–­ï¼šå¤§ä¾¿ä¸ç²˜/åå¹²ï¼Œç¦ç”¨äºŒå¦™ä¸¸ (é˜²ç‡¥ä¼¤é˜´)ã€‚<br>";
    }
    // é˜²é£é€šåœ£ä¸¸ç†”æ–­æœºåˆ¶
    if (key === 'migraine_wind_heat' && rhr > 75) {
        warningMsg += "ğŸ›‘ ç†”æ–­ï¼šRHRè¿‡é«˜ (>75)ï¼Œç¦ç”¨é˜²é£é€šåœ£ (é˜²å¿ƒæ‚¸)ã€‚<br>";
    }

    // 2. æ¸²æŸ“æ¨¡å—
    // è­¦å‘Šæ¨¡å—
    if (db.warn || warningMsg) {
        container.innerHTML += `
            <div class="med-box warning">
                ${warningMsg ? warningMsg : db.warn}
            </div>
        `;
    }

    // è¡ŒåŠ¨æ¨¡å—
    container.innerHTML += `
        <div class="med-box action">
            <h3>ğŸŸ¢ SOP ACTION (è¡ŒåŠ¨æŒ‡ä»¤)</h3>
            <p>${db.action}</p>
        </div>
    `;

    // ä¸­è¯æ¨¡å—
    let tcmHtml = db.tcm.map(m => `<span class="tag tag-tcm">${m}</span>`).join("");
    container.innerHTML += `
        <div class="med-box tcm">
            <h3>ğŸŸ¨ TCM ARSENAL (ç§äººè¯åº“)</h3>
            <div>${tcmHtml}</div>
        </div>
    `;

    // è¥¿è¯æ¨¡å—
    let westHtml = db.west.map(m => `<span class="tag tag-west">${m}</span>`).join("");
    container.innerHTML += `
        <div class="med-box west">
            <h3>â¬œ WESTERN (è¥¿è¯è¾…åŠ©)</h3>
            <div>${westHtml}</div>
        </div>
    `;
}
</script>

</body>
</html>
